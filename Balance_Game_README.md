# 🧩 Balance Game Bot Guide

이 문서는 **밸런스 게임 디스코드 봇**의 일반 사용자용 설명서입니다.  
개발 관련 내용(설치, 코드, 실행법 등)은 포함하지 않습니다.

---

## 🎮 명령어 설명

### `/balancegame`
특정 투표 메시지를 **자동으로 추적(follow)** 하여, 투표 참여자에게 **즉시 보상(총알)** 을 지급합니다.

**사용 예시:**
```
/balancegame message_id:123456789012345678 reward:300
```

**매개변수 설명**
| 항목 | 설명 | 기본값 |
|------|------|---------|
| `message_id` | 밸런스 게임이 진행 중인 투표 메시지의 ID | 필수 |
| `reward` | 투표 참여자에게 지급할 보상 금액 | 250 |

**채널 제한:**  
`config.BALANCE_GAME_CHANNEL_ID`로 지정된 **밸런스 게임 전용 채널**에서만 명령어 사용이 가능합니다.

---

## ⚙️ 로직 설명

1. **명령 실행 시점**
   - 사용자가 `/balancegame` 명령을 입력하면, 지정된 메시지 ID의 투표 메시지를 가져옵니다.
   - 해당 메시지가 유효한 투표인지, 종료되지 않았는지 검사합니다.
   - 이미 추적 중인 투표라면 중복 실행을 방지합니다.

2. **투표 추적 (Follow) 시작**
   - 투표 메시지를 `active_polls`에 등록하고, 보상을 받은 유저를 추적하기 위한 `rewarded_users` 집합을 생성합니다.
   - 봇이 주기적으로(10초 간격) 해당 투표의 상태를 새로 확인합니다.

3. **보상 지급**
   - 투표 항목(answer)에 새롭게 참여한 유저를 식별합니다.
   - 중복 보상을 방지하기 위해 이미 지급한 유저는 `rewarded_users`에 기록합니다.
   - 새 유저에게 `economy.give_money()`를 통해 즉시 보상 지급 후 채널에 알림 메시지를 표시합니다.
   - 알림은 3초 후 자동 삭제됩니다.

4. **투표 종료 감지**
   - 투표가 종료되면(`poll.expires_at` 기준), 봇이 종료 메시지를 보냅니다.
   - “🏁 밸런스 게임 종료! 총 X명에게 지급 완료.” 형태로 출력됩니다.

5. **리소스 정리**
   - 종료 후 `active_polls` 및 `rewarded_users` 데이터가 자동 정리됩니다.

---

## 🖼️ 예상 출력 결과

### ✅ 명령어 실행 시
```
📊 밸런스 게임 follow 시작!
메시지 ID: 123456789012345678
보상: 250 총알
```

### ✅ 유저가 투표할 때
```
✅ @사용자 투표 완료! 250 총알 지급 완료!
```

(3초 후 자동 삭제)

### 🏁 투표 종료 시
```
🏁 밸런스 게임 종료! 총 17명에게 지급 완료.
```

---

## 📌 요약
| 기능 | 설명 |
|------|------|
| **자동 추적** | 투표 메시지를 주기적으로 감시하여 실시간 보상 |
| **중복 방지** | 이미 보상받은 유저는 재지급되지 않음 |
| **자동 종료 처리** | 투표 만료 시 자동 종료 및 정리 |
| **간단한 인터페이스** | `/balancegame` 명령 한 번으로 설정 완료 |

---
© 2025 Balance Game Bot. All Rights Reserved.
