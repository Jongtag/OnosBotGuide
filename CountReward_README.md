# 🧮 CountReward (카운팅 보상 시스템)

## 📋 기능 개요
`CountReward`는 Discord 서버에서 진행되는 **카운팅 게임**에 참여한 사용자를 추적하고,  
특정 마일스톤(예: 5, 10, 15, …) 달성 시 자동으로 보상을 지급하는 기능을 수행합니다.  
봇은 카운팅 채널의 메시지와 리액션을 기반으로 동작하며,  
정확히 계산 가능한 숫자 또는 수식을 인식하여 처리합니다.

---

## ⚙️ 주요 로직 설명

### ✅ 리액션 감지
- 사용자가 메시지에 `☑️` 리액션을 추가할 때 작동합니다.
- 봇 계정의 리액션만 처리하며, 지정된 카운팅 채널(`COUNTING_CHANNEL_ID`) 내에서만 동작합니다.
- 메시지 내용이 계산 가능한 수식일 경우, 해당 수식을 안전하게 평가(`safe_eval`)하여 숫자로 변환합니다.

### 🧠 안전한 수식 계산 (`safe_eval`)
- `+`, `-`, `*`, `/`, 단항 `-` 연산만 허용합니다.
- 예:  
  - `"1+1"` → `2`  
  - `"3*2.5"` → `7.5`  
  - `"5-2"` → `3`
- 그 외의 연산자나 함수는 모두 차단되어 있습니다.

### 🎯 마일스톤 보상 처리
- `MILESTONE_STEP`(기본 5)의 배수 번호 달성 시 보상을 지급합니다.  
  예: 5, 10, 15, 20 …
- 최근 5회(또는 `MILESTONE_STEP` 값) 동안 카운팅에 기여한 모든 사용자에게 동일한 보상을 지급합니다.
- 보상 금액은 해당 마일스톤 숫자와 동일한 “총알(Bullet)” 단위로 지급됩니다.

### 💰 보상 지급
- `economy.give_money()` 함수를 호출하여 실제 보상 지급을 수행합니다.
- 예를 들어, 15번째 카운트를 달성했다면 해당 구간(11~15)에 참여한 모든 사용자에게 **15 총알**이 지급됩니다.

---

## 💬 예상 출력 예시

| 상황 | 예상 메시지 |
|------|--------------|
| 5번째 카운트 달성 | 🎉 축하합니다! <@UserA> <@UserB>님들이 **5** 카운트를 달성하여 💰 5 총알을 획득했습니다! |
| 10번째 카운트 달성 | 🎉 축하합니다! <@UserC> <@UserD>님들이 **10** 카운트를 달성하여 💰 10 총알을 획득했습니다! |
| 잘못된 메시지 입력 | (아무 반응 없음, 무시됨) |
| 수식 메시지 예시 | `"1+1"` 입력 후 ☑️ → `2`로 계산되어 정상 인식됨 |

---

## 📈 작동 흐름 요약

1. 사용자가 카운팅 채널에 숫자(또는 수식) 메시지 작성  
2. 관리 봇이 ☑️ 리액션 추가  
3. 봇이 해당 메시지의 숫자를 평가 및 저장  
4. 특정 단계(`MILESTONE_STEP`) 도달 시, 최근 참여자에게 보상 지급  
5. 축하 메시지 출력 🎉  

---

## 🎨 예시 시나리오

```
1
2
3
4
5 ☑️  →  🎉 축하합니다! <@UserA>님이 **5** 카운트를 달성하여 💰 5 총알을 획득했습니다!
6
7
8
9
10 ☑️ → 🎉 축하합니다! <@UserA> <@UserB>님들이 **10** 카운트를 달성하여 💰 10 총알을 획득했습니다!
```

---

> 💡 이 시스템은 서버 내 활동 참여도를 높이기 위한 “게이미피케이션” 기능입니다.  
> 사용자는 단순한 숫자 입력만으로도 보상을 얻을 수 있습니다.
